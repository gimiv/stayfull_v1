# Developer Handoff: F-001.1 Multi-Tenancy Isolation

**Priority**: P0 - Production Blocker
**Effort**: 10 hours
**Status**: Ready for Implementation
**Specification**: `.architect/features/F-001.1_MULTI_TENANCY_ISOLATION.md`

---

## ðŸŽ¯ What to Build

Implement organization-based multi-tenancy to enable multiple hotel owners on the same platform with strict data isolation.

---

## ðŸ“‹ Implementation Checklist

### Phase 1: Models (3 hours)
- [ ] Create `Organization` model in `apps/core/models.py`
- [ ] Add `organization` FK to `Hotel` model
- [ ] Add `organization` FK to `Guest` model (update unique constraint to `organization + email`)
- [ ] Add `organization` FK to `Staff` model
- [ ] Run `python manage.py makemigrations`
- [ ] Create data migration to assign existing data to default organization
- [ ] Write 15+ model tests in `apps/core/tests/test_organization_model.py`
- [ ] Run tests - ensure all pass

### Phase 2: Admin (3 hours)
- [ ] Create `OrganizationFilteredAdmin` mixin in `apps/core/admin.py`
- [ ] Update `HotelAdmin` to inherit from mixin
- [ ] Update `RoomTypeAdmin` to inherit from mixin
- [ ] Update `RoomAdmin` to inherit from mixin
- [ ] Update `GuestAdmin` to inherit from mixin
- [ ] Update `ReservationAdmin` to inherit from mixin
- [ ] Update `StaffAdmin` to inherit from mixin
- [ ] Create `OrganizationAdmin` in `apps/core/admin.py`
- [ ] Write admin filtering tests
- [ ] Test manually in Django Admin
- [ ] Run tests - ensure all pass

### Phase 3: API (2 hours)
- [ ] Create `IsOrganizationMemberOrReadOnly` permission in `apps/core/permissions.py`
- [ ] Update `HotelViewSet` with permission and `get_queryset()` filtering
- [ ] Update `RoomTypeViewSet` with permission and filtering
- [ ] Update `RoomViewSet` with permission and filtering
- [ ] Update `GuestViewSet` with permission and filtering
- [ ] Update `ReservationViewSet` with permission and filtering
- [ ] Update `StaffViewSet` with permission and filtering
- [ ] Write API filtering tests
- [ ] Run tests - ensure all pass

### Phase 4: Testing (2 hours)
- [ ] Update all existing tests to include organization
- [ ] Write multi-tenancy isolation tests
- [ ] Test guest email can duplicate across organizations
- [ ] Test admin shows only user's org data
- [ ] Test API returns only user's org data
- [ ] Test superuser sees all orgs
- [ ] Run full test suite
- [ ] Achieve 95%+ coverage
- [ ] Target: 165+ tests passing

### Phase 5: Deployment
- [ ] Run migrations locally
- [ ] Commit all changes
- [ ] Push to Railway
- [ ] Verify deployment successful
- [ ] Notify architect for UAT resume

---

## ðŸ“š Reference

**Full Specification**: `.architect/features/F-001.1_MULTI_TENANCY_ISOLATION.md`

**Key Files to Modify**:
- `apps/core/models.py` - Organization model
- `apps/core/admin.py` - OrganizationFilteredAdmin mixin
- `apps/core/permissions.py` - NEW file
- `apps/hotels/models.py` - Add organization FK
- `apps/guests/models.py` - Add organization FK, update unique constraint
- `apps/staff/models.py` - Add organization FK
- All admin files (6 files)
- All viewset files (6 files)

**Migration Strategy**:
- Create default organization: "Default Organization" (slug: "default")
- Assign all existing hotels, guests, staff to default org
- No data loss, backward compatible

---

## âœ… Definition of Done

- All 165+ tests passing
- 95%+ coverage maintained
- Admin filtering works (manual test)
- API filtering works (manual test)
- Deployed to Railway
- Ready for UAT

---

## ðŸš€ Start When Ready

Read the full specification, then begin implementation.

Ask architect if you have any questions or encounter blockers.

**Target Completion**: 10 hours from start
